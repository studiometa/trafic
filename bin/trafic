#!/usr/bin/env zsh

set -o errexit
set -o nounset
set -o pipefail
if [[ "${TRACE-0}" == "1" ]]; then
	set -o xtrace
fi

if [[ "${1-}" =~ ^-*h(elp)?$ ]]; then
	echo 'Usage: trafic <command>

trafic list
	List synced projects

trafic sync
	Sync projects

trafic stop
	Stop stale projects

trafic restart
	Restart services

trafic update
	Pull repository and run migrations
'
	exit
fi

cd "$(dirname "$0")"

export TRAFIC_BIN_DIR=$(pwd)
export TRAFIC_ROOT_DIR=$(realpath ..)

main() {
	CMD=${1:-list}

	if [[ -f $TRAFIC_BIN_DIR/commands/$CMD.sh ]]
	then
		source "$TRAFIC_BIN_DIR/commands/$CMD.sh"
	fi
}

main "$@"

